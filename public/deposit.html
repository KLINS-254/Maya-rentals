<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HOENGAGER RTX - Deposit</title>
<style>
:root{
    --primary-teal:#00d1c1;
    --bg-light:#e0f7f3;
    --card-white:#ffffff;
}

body{
    font-family:'Segoe UI', Tahoma, sans-serif;
    background:var(--bg-light);
    margin:0;
    padding:20px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:20px;
}

.payment-container{
    width:100%;
    max-width:400px;
    background:#4caf50;
    border-radius:15px;
    padding:15px;
    color:white;
    text-align:center;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

.order-no{ font-weight:bold; font-size:0.9rem; margin-bottom:10px; }

.white-box{
    background:white;
    border-radius:10px;
    padding:12px;
    margin:10px 0;
    color:#333;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.label-top{ font-size:0.85rem; color:#fff; text-align:left; width:100%; }

.copy-link{ color:var(--primary-teal); font-size:0.8rem; cursor:pointer; }

.timer-box{
    border:1px dashed white;
    padding:5px 20px;
    display:inline-block;
    font-size:1.5rem;
    margin:10px 0;
}

/* Recipient box */
.recipient-box{
    display:flex;
    gap:10px;
    margin-top:10px;
}

.recipient-input{
    flex:1;
    padding:10px;
    border-radius:8px;
    border:1px solid #ccc;
    outline:none;
    font-size:1rem;
}

.recipient-input.invalid{
    border-color:red;
    color:red;
}

/* Pop-up modal */
.modal{
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.5);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:999;
}

.modal-content{
    width:90%;
    max-width:350px;
    background:white;
    border-radius:25px;
    padding:25px;
    text-align:center;
    position:relative;
}

.modal-header{
    font-weight:bold;
    margin-bottom:15px;
    font-size:1.1rem;
}

.close{
    position:absolute;
    right:15px; top:10px;
    cursor:pointer;
    font-size:20px;
}

/* Done button */
.btn-done{
    margin-top:15px;
    padding:10px 20px;
    border:none;
    border-radius:25px;
    background:var(--primary-teal);
    color:white;
    font-weight:bold;
    cursor:pointer;
}
</style>
</head>
<body>

<div class="payment-container">
    <div class="order-no" id="orderNumber">ORDER NO: W115S177226678101XXXXX</div>
    
    <div class="label-top">E-Wallet (constant)</div>
    <div class="white-box">
        <span id="ewallet-number">0789016069</span>
        <span class="copy-link" id="copy-ewallet">‚ùê Copy</span>
    </div>

    <div class="label-top">Amount to pay</div>
    <div class="white-box">
        <div style="display:flex; align-items:center; gap:10px;">
            <div style="background:red; color:white; border-radius:50%; width:40px; height:40px; display:flex; justify-content:center; align-items:center; font-weight:bold; font-size:0.7rem;">KES</div>
            <span id="amount-to-pay">0.00</span>
        </div>
    </div>

    <div class="timer-box" id="timer">14:59</div>

    <div class="recipient-box">
        <input type="text" id="recipient-number" class="recipient-input" placeholder="Enter your number (07xxxxxxx)" readonly>
        <button id="edit-btn" class="btn-done">Edit</button>
    </div>
</div>

<!-- Modal for recipient input -->
<div class="modal" id="recipientModal">
    <div class="modal-content">
        <div class="modal-header">Enter your number</div>
        <input type="text" id="modal-recipient" class="recipient-input" placeholder="07XXXXXXXX">
        <button class="btn-done" id="modal-done">Done</button>
    </div>
</div>

<script>
// --- Randomize last 5 digits of order ---
const orderPrefix = "W115S177226678101";
function generateOrderNumber(){
    let lastFive = "";
    for(let i=0;i<5;i++){ lastFive += Math.floor(Math.random()*10); }
    return orderPrefix + lastFive;
}
document.getElementById('orderNumber').innerText = "ORDER NO: " + generateOrderNumber();

// --- Copy e-wallet number ---
document.getElementById("copy-ewallet").addEventListener("click", ()=>{
    navigator.clipboard.writeText(document.getElementById("ewallet-number").innerText);
    alert("E-Wallet number copied!");
});

// --- Get amount from URL parameter ---
function getAmount(){
    const params = new URLSearchParams(window.location.search);
    const amt = params.get("amount");
    if(amt && !isNaN(amt)) document.getElementById("amount-to-pay").innerText = parseFloat(amt).toFixed(2);
}
getAmount();

// --- Recipient number modal ---
const recipientModal = document.getElementById("recipientModal");
const modalDone = document.getElementById("modal-done");
const recipientInput = document.getElementById("recipient-number");
const modalInput = document.getElementById("modal-recipient");

// Show modal on load
recipientModal.style.display = "flex";

modalDone.addEventListener("click", ()=>{
    const val = modalInput.value.trim();
    if(!/^07\d{8}$/.test(val)){
        modalInput.classList.add("invalid");
        return;
    }
    modalInput.classList.remove("invalid");
    recipientInput.value = val;
    recipientInput.setAttribute("readonly","true");
    recipientModal.style.display="none";
    startTimer();
});

// Edit recipient only before timer
document.getElementById("edit-btn").addEventListener("click", ()=>{
    if(!countdown){
        recipientInput.removeAttribute("readonly");
        recipientModal.style.display="flex";
        modalInput.value = recipientInput.value;
    }
});

// Recipient input validation
recipientInput.addEventListener("input", ()=>{
    const val = recipientInput.value;
    if(!/^07\d{0,8}$/.test(val)){
        recipientInput.classList.add("invalid");
    } else if(val.length>10){
        recipientInput.value = val.slice(0,10);
        recipientInput.classList.remove("invalid");
    } else {
        recipientInput.classList.remove("invalid");
    }
});

// --- Timer ---
let countdown;
function startTimer(){
    let time = 14*60 + 59;
    const timerBox = document.getElementById("timer");
    clearInterval(countdown);
    countdown = setInterval(()=>{
        let m = Math.floor(time/60);
        let s = time%60;
        s = s<10?"0"+s:s;
        timerBox.innerText = m + ":" + s;
        if(time<=0){
            clearInterval(countdown);
            countdown = null;
            alert("Time expired. Returning to deposit page.");
            window.location.href="deposit.html";
        }
        time--;
    },1000);
}
</script>
</body>
</html>
